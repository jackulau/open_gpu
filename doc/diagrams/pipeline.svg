<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 400" width="900" height="400">
  <defs>
    <marker id="arr" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#4a5568"/>
    </marker>
    <style>
      .stage { stroke-width: 2; }
      .if-stage { fill: #fed7d7; stroke: #c53030; }
      .id-stage { fill: #feebc8; stroke: #c05621; }
      .ex-stage { fill: #c6f6d5; stroke: #276749; }
      .mem-stage { fill: #bee3f8; stroke: #2b6cb0; }
      .wb-stage { fill: #e9d8fd; stroke: #553c9a; }
      .title { font-family: Arial, sans-serif; font-size: 13px; font-weight: bold; fill: #1a202c; }
      .label { font-family: Arial, sans-serif; font-size: 10px; fill: #4a5568; }
      .small { font-family: Arial, sans-serif; font-size: 9px; fill: #718096; }
      .arrow { stroke: #4a5568; stroke-width: 2; fill: none; marker-end: url(#arr); }
      .bypass { stroke: #e53e3e; stroke-width: 1.5; fill: none; stroke-dasharray: 4,2; marker-end: url(#arr); }
    </style>
  </defs>

  <!-- Title -->
  <text x="450" y="25" text-anchor="middle" class="title" style="font-size: 16px;">5-Stage Pipeline Architecture</text>

  <!-- Pipeline Stages -->
  <!-- IF Stage -->
  <rect x="30" y="50" width="150" height="200" rx="8" class="stage if-stage"/>
  <text x="105" y="75" text-anchor="middle" class="title">IF (Fetch)</text>
  <line x1="45" y1="85" x2="165" y2="85" stroke="#c53030" stroke-width="1"/>

  <rect x="45" y="95" width="120" height="25" rx="3" fill="#fff" stroke="#c53030"/>
  <text x="105" y="112" text-anchor="middle" class="label">Program Counter</text>

  <rect x="45" y="130" width="120" height="35" rx="3" fill="#fff" stroke="#c53030"/>
  <text x="105" y="147" text-anchor="middle" class="label">I-Cache Access</text>
  <text x="105" y="159" text-anchor="middle" class="small">16KB, 4-way</text>

  <rect x="45" y="175" width="120" height="30" rx="3" fill="#fff" stroke="#c53030"/>
  <text x="105" y="194" text-anchor="middle" class="label">Instr Buffer</text>

  <rect x="45" y="215" width="120" height="25" rx="3" fill="#fff" stroke="#c53030"/>
  <text x="105" y="232" text-anchor="middle" class="small">Branch Predict</text>

  <!-- Arrow IF -> ID -->
  <line x1="180" y1="150" x2="210" y2="150" class="arrow"/>

  <!-- ID Stage -->
  <rect x="210" y="50" width="150" height="200" rx="8" class="stage id-stage"/>
  <text x="285" y="75" text-anchor="middle" class="title">ID (Decode)</text>
  <line x1="225" y1="85" x2="345" y2="85" stroke="#c05621" stroke-width="1"/>

  <rect x="225" y="95" width="120" height="30" rx="3" fill="#fff" stroke="#c05621"/>
  <text x="285" y="114" text-anchor="middle" class="label">Instr Decoder</text>

  <rect x="225" y="135" width="120" height="35" rx="3" fill="#fff" stroke="#c05621"/>
  <text x="285" y="152" text-anchor="middle" class="label">Register Read</text>
  <text x="285" y="164" text-anchor="middle" class="small">2 ports</text>

  <rect x="225" y="180" width="120" height="30" rx="3" fill="#fff" stroke="#c05621"/>
  <text x="285" y="199" text-anchor="middle" class="label">Imm Generator</text>

  <rect x="225" y="220" width="120" height="20" rx="3" fill="#fff" stroke="#c05621"/>
  <text x="285" y="234" text-anchor="middle" class="small">Scoreboard Check</text>

  <!-- Arrow ID -> EX -->
  <line x1="360" y1="150" x2="390" y2="150" class="arrow"/>

  <!-- EX Stage -->
  <rect x="390" y="50" width="150" height="200" rx="8" class="stage ex-stage"/>
  <text x="465" y="75" text-anchor="middle" class="title">EX (Execute)</text>
  <line x1="405" y1="85" x2="525" y2="85" stroke="#276749" stroke-width="1"/>

  <rect x="405" y="95" width="55" height="45" rx="3" fill="#fff" stroke="#276749"/>
  <text x="432" y="115" text-anchor="middle" class="label">INT</text>
  <text x="432" y="128" text-anchor="middle" class="small">ALU</text>

  <rect x="470" y="95" width="55" height="45" rx="3" fill="#fff" stroke="#276749"/>
  <text x="497" y="115" text-anchor="middle" class="label">FP</text>
  <text x="497" y="128" text-anchor="middle" class="small">ALU</text>

  <rect x="405" y="150" width="120" height="30" rx="3" fill="#fff" stroke="#276749"/>
  <text x="465" y="169" text-anchor="middle" class="label">Branch Eval</text>

  <rect x="405" y="190" width="120" height="30" rx="3" fill="#fff" stroke="#276749"/>
  <text x="465" y="209" text-anchor="middle" class="label">Addr Calc</text>

  <rect x="405" y="230" width="120" height="15" rx="3" fill="#fff" stroke="#276749"/>
  <text x="465" y="241" text-anchor="middle" class="small">MUL/DIV</text>

  <!-- Arrow EX -> MEM -->
  <line x1="540" y1="150" x2="570" y2="150" class="arrow"/>

  <!-- MEM Stage -->
  <rect x="570" y="50" width="150" height="200" rx="8" class="stage mem-stage"/>
  <text x="645" y="75" text-anchor="middle" class="title">MEM (Memory)</text>
  <line x1="585" y1="85" x2="705" y2="85" stroke="#2b6cb0" stroke-width="1"/>

  <rect x="585" y="95" width="120" height="35" rx="3" fill="#fff" stroke="#2b6cb0"/>
  <text x="645" y="112" text-anchor="middle" class="label">D-Cache Access</text>
  <text x="645" y="124" text-anchor="middle" class="small">32KB, 4-way</text>

  <rect x="585" y="140" width="120" height="30" rx="3" fill="#fff" stroke="#2b6cb0"/>
  <text x="645" y="159" text-anchor="middle" class="label">Load/Store</text>

  <rect x="585" y="180" width="120" height="30" rx="3" fill="#fff" stroke="#2b6cb0"/>
  <text x="645" y="199" text-anchor="middle" class="label">Coalescing</text>

  <rect x="585" y="220" width="120" height="20" rx="3" fill="#fff" stroke="#2b6cb0"/>
  <text x="645" y="234" text-anchor="middle" class="small">Sign Extend</text>

  <!-- Arrow MEM -> WB -->
  <line x1="720" y1="150" x2="750" y2="150" class="arrow"/>

  <!-- WB Stage -->
  <rect x="750" y="50" width="120" height="200" rx="8" class="stage wb-stage"/>
  <text x="810" y="75" text-anchor="middle" class="title">WB (Write)</text>
  <line x1="765" y1="85" x2="855" y2="85" stroke="#553c9a" stroke-width="1"/>

  <rect x="765" y="100" width="90" height="35" rx="3" fill="#fff" stroke="#553c9a"/>
  <text x="810" y="117" text-anchor="middle" class="label">Register</text>
  <text x="810" y="129" text-anchor="middle" class="label">Write</text>

  <rect x="765" y="145" width="90" height="30" rx="3" fill="#fff" stroke="#553c9a"/>
  <text x="810" y="164" text-anchor="middle" class="label">Scoreboard</text>

  <rect x="765" y="185" width="90" height="25" rx="3" fill="#fff" stroke="#553c9a"/>
  <text x="810" y="202" text-anchor="middle" class="small">Completion</text>

  <!-- Forwarding/Bypass Paths -->
  <text x="450" y="280" text-anchor="middle" class="title" style="fill: #e53e3e;">Data Forwarding Paths</text>

  <!-- EX -> EX bypass -->
  <path d="M 465 250 L 465 290 L 420 290 L 420 320 L 465 320 L 465 270" class="bypass"/>
  <text x="465" y="335" text-anchor="middle" class="small" style="fill:#e53e3e;">EX→EX</text>

  <!-- MEM -> EX bypass -->
  <path d="M 645 250 L 645 305 L 400 305 L 400 270" class="bypass"/>
  <text x="520" y="315" text-anchor="middle" class="small" style="fill:#e53e3e;">MEM→EX</text>

  <!-- WB -> ID bypass -->
  <path d="M 810 250 L 810 355 L 285 355 L 285 250" class="bypass"/>
  <text x="550" y="365" text-anchor="middle" class="small" style="fill:#e53e3e;">WB→ID (Register File)</text>

  <!-- Branch misprediction path -->
  <path d="M 465 50 L 465 35 L 105 35 L 105 50" stroke="#805ad5" stroke-width="1.5" fill="none" stroke-dasharray="3,3" marker-end="url(#arr)"/>
  <text x="285" y="32" text-anchor="middle" class="small" style="fill:#805ad5;">Branch Misprediction → Flush</text>

  <!-- Pipeline Timing -->
  <rect x="30" y="380" width="840" height="15" rx="3" fill="#edf2f7"/>
  <text x="105" y="392" text-anchor="middle" class="small">Cycle 1</text>
  <text x="285" y="392" text-anchor="middle" class="small">Cycle 2</text>
  <text x="465" y="392" text-anchor="middle" class="small">Cycle 3</text>
  <text x="645" y="392" text-anchor="middle" class="small">Cycle 4</text>
  <text x="810" y="392" text-anchor="middle" class="small">Cycle 5</text>

</svg>
